
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Atlas: the_hobbit_graphrag</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"></script>
    <script src="https://unpkg.com/three-spritetext@1.6.5/dist/three-spritetext.min.js"></script>
    <script src="https://unpkg.com/three-forcegraph"></script>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #container { width: 100%; height: 100vh; }
        #info-panel { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            background: rgba(255,255,255,0.8); 
            padding: 15px; 
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            max-width: 300px;
        }
        h1, h2 { margin-top: 0; color: #333; }
        .stat { margin: 5px 0; }
        .legend { display: flex; flex-wrap: wrap; margin-top: 10px; }
        .legend-item { 
            display: flex; 
            align-items: center; 
            margin-right: 15px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .legend-color { 
            width: 15px; 
            height: 15px; 
            margin-right: 5px; 
            border-radius: 50%; 
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info-panel">
        <h1>Narrative Atlas</h1>
        <h2>the_hobbit_graphrag</h2>
        <div class="stats">
            <div class="stat">Characters: 0</div>
            <div class="stat">Events: 0</div>
            <div class="stat">Locations: 0</div>
            <div class="stat">Themes: 0</div>
        </div>
        <div class="legend">
            <div class="legend-item" data-type="character">
                <div class="legend-color" style="background-color: #3498db;"></div>
                <div>Characters</div>
            </div>
            <div class="legend-item" data-type="event">
                <div class="legend-color" style="background-color: #e74c3c;"></div>
                <div>Events</div>
            </div>
            <div class="legend-item" data-type="location">
                <div class="legend-color" style="background-color: #2ecc71;"></div>
                <div>Locations</div>
            </div>
            <div class="legend-item" data-type="theme">
                <div class="legend-color" style="background-color: #9b59b6;"></div>
                <div>Themes</div>
            </div>
        </div>
    </div>

    <script>
        // Visualization data
        const data = {"nodes": [], "links": [], "metadata": {"title": "the_hobbit_graphrag", "segments": 0, "timeline_start": 0.0, "timeline_end": 0.0, "character_count": 0, "event_count": 0, "location_count": 0, "theme_count": 0}};
        
        // Initialize 3D Graph
        const Graph = ForceGraph3D()
            (document.getElementById('container'))
            .graphData(data)
            .nodeId('id')
            .nodeLabel('name')
            .nodeColor('color')
            .nodeVal('size')
            .linkWidth(1)
            .linkOpacity(0.5)
            .backgroundColor('#f7f7f7')
            .showNavInfo(true);
            
        // Add text labels to nodes
        Graph.nodeThreeObject(node => {
            const sprite = new SpriteText(node.name);
            sprite.color = node.color;
            sprite.textHeight = 4;
            sprite.position.y = node.size + 4;
            return sprite;
        });
        
        // Position nodes based on cylindrical coordinates
        Graph.nodePositionUpdate((node, pos) => {
            // Convert cylindrical coordinates to Cartesian
            const radius = node.distance * 100;
            const angle = node.angle * (Math.PI / 180);
            const height = node.time * 20;
            
            return {
                x: radius * Math.cos(angle),
                y: height,
                z: radius * Math.sin(angle)
            };
        });
        
        // Legend toggle functionality
        document.querySelectorAll('.legend-item').forEach(item => {
            item.addEventListener('click', () => {
                const type = item.getAttribute('data-type');
                const graphData = Graph.graphData();
                
                // Toggle visibility
                const newNodes = graphData.nodes.map(node => {
                    if (node.type === type) {
                        return {
                            ...node,
                            hidden: !node.hidden
                        };
                    }
                    return node;
                });
                
                Graph.graphData({
                    nodes: newNodes,
                    links: graphData.links
                });
                
                // Toggle legend item style
                item.style.opacity = item.style.opacity === '0.5' ? '1' : '0.5';
            });
        });
    </script>
</body>
</html>
    